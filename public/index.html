<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Gestione inventario magazzino multi-utente">
  <meta name="theme-color" content="#2563eb">

  <title>Inventario Magazzino</title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%232563eb'/><text x='50' y='50' font-size='48' text-anchor='middle' dominant-baseline='central' fill='white' font-family='sans-serif' font-weight='bold'>IM</text></svg>">

  <!-- Styles -->
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-title-wrapper">
        <h1 id="inventoryTitle" class="header-title">üì¶ Inventario Magazzino</h1>
        <button id="editTitleBtn" class="edit-title-btn" title="Modifica nome inventario" aria-label="Modifica nome inventario">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </button>
      </div>
      <input
        type="text"
        id="inventoryTitleInput"
        class="header-title-input"
        style="display: none;"
        maxlength="100"
        placeholder="Nome inventario"
      >
      <div class="header-info">
        <button id="copyUuidBtn" class="uuid-badge" title="Copia UUID" aria-label="Copia UUID negli appunti">
          <span id="uuidDisplay">...</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
        <div class="badge" id="totalBadge">0 prodotti</div>
        <button id="exportBtn" class="btn btn-export" title="Esporta inventario" aria-label="Esporta inventario">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Esporta
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container main-content">
    <!-- Add Product Form -->
    <section class="card add-product-section">
      <h2>Aggiungi Prodotto</h2>
      <form id="addProductForm">
        <div class="form-group">
          <label for="productName">Nome Prodotto</label>
          <div class="autocomplete-wrapper">
            <input
              type="text"
              id="productName"
              name="name"
              placeholder="Es: Laptop Dell XPS 15"
              required
              autocomplete="off"
            >
            <div id="autocompleteList" class="autocomplete-list"></div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="productQuantity">Quantit√†</label>
            <input
              type="number"
              id="productQuantity"
              name="quantity"
              min="0"
              value="1"
              required
            >
          </div>
          <button type="submit" class="btn btn-primary btn-add">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Aggiungi
          </button>
        </div>
      </form>
    </section>

    <!-- Products List -->
    <section class="products-section">
      <div class="section-header">
        <h2>Prodotti</h2>
        <button id="newInventoryBtn" class="btn btn-secondary">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="12" y1="18" x2="12" y2="12"></line>
            <line x1="9" y1="15" x2="15" y2="15"></line>
          </svg>
          Nuovo Inventario
        </button>
      </div>

      <!-- Sort Control -->
      <div class="sort-control">
        <!-- Search Input -->
        <div class="search-wrapper">
          <label for="searchInput" class="search-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            Cerca:
          </label>
          <div class="search-input-container">
            <input
              type="text"
              id="searchInput"
              class="search-input"
              placeholder="Filtra per nome..."
              autocomplete="off"
            >
            <button id="clearSearchBtn" class="clear-search-btn" title="Pulisci ricerca" aria-label="Pulisci ricerca" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- Sort Select -->
        <div class="sort-wrapper">
          <label for="sortSelect" class="sort-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="4" y1="6" x2="20" y2="6"></line>
              <line x1="8" y1="12" x2="20" y2="12"></line>
              <line x1="12" y1="18" x2="20" y2="18"></line>
            </svg>
            Ordina per:
          </label>
          <select id="sortSelect" class="sort-select">
            <option value="name-asc">Nome (A-Z)</option>
            <option value="name-desc">Nome (Z-A)</option>
            <option value="quantity-asc">Quantit√† (crescente)</option>
            <option value="quantity-desc">Quantit√† (decrescente)</option>
            <option value="date-desc">Pi√π recenti</option>
            <option value="date-asc">Pi√π vecchi</option>
          </select>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="loading-state">
        <div class="spinner"></div>
        <p>Caricamento...</p>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state" style="display: none;">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M20 7h-9"></path>
          <path d="M14 17H5"></path>
          <circle cx="17" cy="17" r="3"></circle>
          <circle cx="7" cy="7" r="3"></circle>
        </svg>
        <h3>Nessun prodotto</h3>
        <p>Inizia aggiungendo il primo prodotto all'inventario!</p>
      </div>

      <!-- Products List -->
      <div id="productsList" class="products-list"></div>

      <!-- QR Code Section -->
      <div id="qrCodeSection" class="qr-code-section" style="display: none;">
        <div class="qr-code-card">
          <h3 class="qr-code-title">Condividi Inventario</h3>
          <p class="qr-code-description">Scansiona il QR code per condividere questo inventario</p>
          <div id="qrCodeContainer" class="qr-code-container"></div>
          <div class="qr-code-url">
            <input type="text" id="qrCodeUrl" class="qr-code-url-input" readonly>
            <button id="copyUrlBtn" class="btn-copy-url" title="Copia URL" aria-label="Copia URL negli appunti">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copia URL
            </button>
          </div>
        </div>
      </div>

      <!-- Offline Message -->
      <div id="offlineMessage" class="offline-message" style="display: none;">
        ‚ö†Ô∏è Offline - riconnetti per sincronizzare
      </div>
    </section>
  </main>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal" style="display: none;">
    <div class="modal-overlay" id="exportModalOverlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2>Esporta Inventario</h2>
        <button id="closeExportModal" class="modal-close" aria-label="Chiudi">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <p>Scegli il formato per esportare l'inventario:</p>
        <div class="export-options">
          <button class="export-option-btn" data-format="csv">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <div class="export-option-title">CSV</div>
            <div class="export-option-desc">Per Excel/Google Sheets</div>
          </button>
          <button class="export-option-btn" data-format="pdf">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            <div class="export-option-title">PDF</div>
            <div class="export-option-desc">Per stampa/archiviazione</div>
          </button>
          <button class="export-option-btn" data-format="text">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <line x1="12" y1="9" x2="8" y2="9"></line>
            </svg>
            <div class="export-option-title">TESTO</div>
            <div class="export-option-desc">Per condivisione rapida</div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="/app.js"></script>
</body>
</html>
